<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Demo Kurve</title>
    <link rel='icon' type='image/x-icon' href='/favicon.ico'>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@^2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@^1"></script>

    <link rel='stylesheet' href='/css/atmos.css'>
    <link rel='stylesheet' href='/css/input.css'>
    <!--<script src='/js/chart.js'></script>-->
    <script src='/js/chart2.js'></script>
    <script src='/js/websocket.js'></script>
</head>
<body>
    <h1>ASP.NET Core Minimal API WebSocket Trend Test</h1>

    <div style="position:absolute; right:1rem; top:1rem;">
        <input type="hidden" id="hour" data-name='A01_DB10_DBW2' />
        <input type="hidden" id="min" data-name='A01_DB10_DBW4' />
        <input type="hidden" id="sec" data-name='A01_DB10_DBW6' onchange="clock();" />
        SPS-Zeit <span id="time"></span>
    </div>

    <canvas id="myChart" class="chart" style="background-color: rgb(70, 70, 70); min-width: 50vw; max-width: 100vw; height: 40vh; max-height: 50vh; "></canvas>
    <div class="container controls" style="max-width: fit-content; margin-left: auto; margin-right: auto;">
        <input type="datetime-local" id="start" name="start" onfocusout="loadChart('myChart', 'start', 'end', tags);">
        <input type="datetime-local" id="end" name="end" onfocusout="loadChart('myChart', 'start', 'end', tags);">
        <input type="button" class="myButton" onclick="setDatesHours('start', 'end', 8); loadChart('myChart', 'start', 'end', tags);" value="8 Stunden" />
        <input type="button" class="myButton" onclick="setDatesHours('start', 'end',24); loadChart('myChart', 'start', 'end', tags);" value="24 Stunden" />
        <input type="button" class="myButton" onclick="excelExport('start', 'end', tags);" value="Excel Export" />

    </div>
    <div id="progressContainer" style="position: absolute; top:10px; left: 40%; margin: auto; display: none; ">
        <label for="progressBar">Verarbeitung:</label>
        <progress id="progressBar" value="0" max="100" style="width: 300px;"></progress>
        <span id="progressText">0%</span>
    </div>

    <a id="rawDataLink" style="position:absolute; bottom:0.5rem; left:0.5rem;color:white; text-decoration:none;">Rohdaten</a>
    <script>

        const tags = new Map([
            ['A01_DB10_DBW2', 'Stunden'],
            ['A01_DB10_DBW4', 'Minuten'],
            ['A01_DB10_DBW6', 'Sekunden']
        ]);

        initChart('myChart');
        setDatesHours('start', 'end', 8);
        loadChart('myChart', 'start', 'end', tags);

    </script>
    <style>
    </style>


</body>
</html>