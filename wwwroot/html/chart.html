<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>WebSocket Client</title>
    <link rel='icon' type='image/x-icon' href='/favicon.ico'>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@^2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@^1"></script>
    <link rel='stylesheet' href='/css/atmos.css'>
    <link rel='stylesheet' href='/css/input.css'>
    <script src='/js/chart.js'></script>
    <script src='/js/websocket.js'></script>
</head>
<body>
    <h1>ASP.NET Core Minimal API WebSocket Trend Test</h1>

    <input type="number" data-name='A01_DB10_DBW2'>
    <input type="number" data-name='A01_DB10_DBW4'>
    <input type="number" data-name='A01_DB10_DBW6'>

    <canvas id="myChart" class="chart" style="background-color:white;max-width:50rem;height:40vh;max-height:50vh;"></canvas>
        <input type="datetime-local" id="start" name="start" onfocusout="loadChart('myChart');">
        <input type="datetime-local" id="end" name="end" onfocusout="loadChart('myChart');">
        <input type="button" onclick="setDates(8);loadChart('myChart');" value="8 Stunden" />
        <input type="button" onclick="setDates(24);loadChart('myChart');" value="24 Stunden" />
        <input type="button" onclick="removeData('myChart');" value="löschen" />
    
        <a id="rawDataLink" style="position:absolute; bottom:0.5rem; left:0.5rem;color:white; text-decoration:none;"></a>
    <script>
        function loadChart(chartId) {
            const start = new Date(document.getElementById('start').value);
            const end = new Date(document.getElementById('end').value);

            if (isNaN(start) || isNaN(end)) {
                console.error(`Zeitbereich ${start} bis ${end} ist ungültig.`);
                return;
            }

            tagNames = [
                'A01_DB10_DBW2',
                'A01_DB10_DBW4',
                'A01_DB10_DBW6'
            ]

            removeData("myChart");
            addChartDataDb("myChart", tagNames, start, end);
        }

        function setDates(std) {
            var now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('end').value = now.toISOString().slice(0, 16);

            var begin = new Date();
            begin.setUTCHours(begin.getHours()-std);
            document.getElementById('start').value = begin.toISOString().slice(0, 16);
        }

        setDates(8);
        loadChart('myChart');
    </script>


</body>
</html>