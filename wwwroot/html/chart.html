<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Demo Kurve</title>
    <link rel='icon' type='image/x-icon' href='/favicon.ico'>
    <link rel='stylesheet' href='/css/style.css'>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@^2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@^1"></script>
    <script src='/js/chart.js'></script>
    <script src='/js/excel.js'></script>
    <script src='/js/websocket.js'></script>
</head>
<body>
    <h1>Demo Kurvendarstellung</h1>

    <div style="position:absolute; right:0.5rem; top:3rem;">
        <input type="hidden" id="hour" data-name='A01_DB10_DBW2' />
        <input type="hidden" id="min" data-name='A01_DB10_DBW4' />
        <input type="hidden" id="sec" data-name='A01_DB10_DBW6' />
        SPS-Zeit <span id="time"></span>
        <script>
            function clock() {
                h = document.getElementById('hour').value;
                m = document.getElementById('min').value;
                s = document.getElementById('sec').value;
                document.getElementById('time').innerHTML = h.padStart(2, "0") + ':' + m.padStart(2, "0") + ':' + s.padStart(2, "0");
            }
            window.setInterval(clock, 1000);
        </script>
    </div>

    <canvas id="myChart1" class="chart" style="background-color: rgb(70, 70, 70); min-width: 50vw; max-width: 90vw; height: 30vh; max-height: 40vh; "></canvas>
    <div class="container controls" style="max-width: fit-content; margin-left: auto; margin-right: auto;">
        <input type="datetime-local" id="start" name="start" onfocusout="loadAllCharts();">
        <input type="datetime-local" id="end" name="end" onfocusout="loadAllCharts();">
        <input type="button" class="myButton" onclick="setDatesHours('start', 'end', 8);loadAllCharts();" value="8 Stunden" />
        <input type="button" class="myButton" onclick="setDatesHours('start', 'end',24);loadAllCharts();" value="24 Stunden" />
        <input type="button" class="myButton" onclick="excelExport(  'start', 'end', 0, getAllTags([tags1,tags2]));" value="Excel Export" />
    </div>
    <canvas id="myChart2" class="chart" style="background-color: rgb(70, 70, 70); min-width: 50vw; max-width: 90vw; height: 30vh; max-height: 40vh; "></canvas>

    <div id="progressContainer" style="position: absolute; top:10px; left: 40%; margin: auto; display: none; ">
        <label for="progressBar">Verarbeitung:</label>
        <progress id="progressBar" value="0" max="100" style="width: 300px;"></progress>
        <span id="progressText">0%</span>
    </div>

    <a id="rawDataLink" style="position:absolute; bottom:0.5rem; left:0.5rem;color:white; text-decoration:none;">Rohdaten</a>
    <script>

        const tags1 = new Map([
            ['A01_DB10_DBW2', 'Stunden'],
            ['A01_DB10_DBW4', 'Minuten'],
            ['A01_DB10_DBW6', 'Sekunden']
        ]);

        const tags2 = new Map([
            ['A01_DB10_DBW4', 'Alternative Minuten']
        ]);

        initChart('myChart1');
        initChart('myChart2');
        setDatesHours('start', 'end', 8);
        loadAllCharts();

        function loadAllCharts() {
            loadChart('myChart1', 'start', 'end', tags1);
            loadChart('myChart2', 'start', 'end', tags2);
        }



    </script> 
</body>
</html>