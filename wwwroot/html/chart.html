<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Demo Kurve</title>
    <link rel='icon' type='image/x-icon' href='/favicon.ico'>
    <link rel='stylesheet' href='/css/style.css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@^2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@^1"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script> <!-- für PAN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/2.2.0/chartjs-plugin-zoom.min.js" integrity="sha512-FRGbE3pigbYamZnw4+uT4t63+QJOfg4MXSgzPn2t8AWg9ofmFvZ/0Z37ZpCawjfXLBSVX2p2CncsmUH2hzsgJg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src='/js/chart.js'></script>
    <script src='/js/excel.js'></script>
    <script src='/js/websocket.js'></script>
</head>
<body>
    <h1>Demo Kurvendarstellung</h1>

    <span id="customspinner"></span>

    <div style="position:absolute; right:0.5rem; top:3.5rem;">
        <input type="hidden" id="hour" data-name='A01_DB10_DBW2' />
        <input type="hidden" id="min" data-name='A01_DB10_DBW4' />
        <input type="hidden" id="sec" data-name='A01_DB10_DBW6' />
        SPS-Zeit <span id="time"></span>
        <script>
            function clock() {
                h = document.getElementById('hour').value;
                m = document.getElementById('min').value;
                s = document.getElementById('sec').value;
                document.getElementById('time').innerHTML = h.padStart(2, "0") + ':' + m.padStart(2, "0") + ':' + s.padStart(2, "0");
            }
            window.setInterval(clock, 1000);
        </script>
    </div>

    <canvas id="myChart1" class="chart" style="background-color: rgb(70, 70, 70); min-width: 50vw; max-width: 90vw; height: 30vh; max-height: 40vh; "></canvas>
    <div class="container controls" style="max-width: fit-content; margin-left: auto; margin-right: auto;">
        <div class="myButton" id="chartTimespan"></div>
        <input type="datetime-local" id="start" name="start" onfocusout="loadAllCharts();">
        <input type="datetime-local" id="end" name="end" onfocusout="loadAllCharts();">
        <button class="myButton" onclick="setDatesHours('start', 'end', 8);loadAllCharts();"><i class="material-icons">schedule</i>8</button>
        <button class="myButton" onclick="setDatesHours('start', 'end',24);loadAllCharts();"><i class="material-icons">schedule</i>24</button>
        <button class="myButton" onclick="excelExport(  'start', 'end', 0, getAllTags([tags1,tags2]));"><i class="material-icons">save</i></button>
        <button class="myButton" onclick="zoom(['myChart1', 'myChart2'], 1.2);"><i class="material-icons">zoom_in</i></button>
        <button class="myButton" onclick="zoom(['myChart1', 'myChart2'], 0.8);"><i class="material-icons">zoom_out</i></button>
        <button class="myButton" onclick="resetZoom(['myChart1', 'myChart2'])"><i class="material-icons">center_focus_weak</i></button>
        <button class="myButton" onclick="panX(['myChart1', 'myChart2'], 100);"><i class="material-icons">arrow_left</i></button>
        <button class="myButton" onclick="panX(['myChart1', 'myChart2'], -100);"><i class="material-icons">arrow_right</i></button>
    </div>
    <canvas id="myChart2" class="chart" style="background-color: rgb(70, 70, 70); min-width: 50vw; max-width: 90vw; height: 30vh; max-height: 40vh; "></canvas>

    <div id="progressContainer" style="position: absolute; top:10px; left: 40%; margin: auto; display: none; ">
        <label for="progressBar">Verarbeitung:</label>
        <progress id="progressBar" value="0" max="100" style="width: 300px;"></progress>
        <span id="progressText">0%</span>
    </div>

    <div id="rawDataLinks" style="position:sticky; bottom:0.5rem; left:0.5rem;"></div>
    
    <script>

        const tags1 = new Map([
            ['A01_DB10_DBW2', 'Stunden'],
            ['A01_DB10_DBW4', 'Minuten'],
            ['A01_DB10_DBW6', 'Sekunden']
        ]);

        const tags2 = new Map([
            ['A01_DB10_DBX7_5', 'Sekunde Bit2'],
            ['A01_DB10_DBX7_4', 'Sekunde Bit3']
        ]);

        initChart('myChart1');
        initChart('myChart2', true);
        setDatesHours('start', 'end', 8);
        loadAllCharts();

        function loadAllCharts() {
            if (checkDuration('start', 'end', 'chartTimespan')) {
                loadChart('myChart1', 'start', 'end', tags1);
                loadChart('myChart2', 'start', 'end', tags2);
            }   

            //updateChart('myChart1', tags1)
        }

        function checkDuration(startId, endId, outputId) {
            const start = new Date(document.getElementById(startId).value);
            const end = new Date(document.getElementById(endId).value);
            const duration = (end - start) / 86400000;
            const obj = document.getElementById(outputId)
            obj.innerHTML = duration.toFixed(0) + ' Tage';

            if (duration > 91 || duration < 0) {
                obj.style.color = 'red';
                return false;
            } else {
                obj.style.color = 'inherit';
                return true;              
            }
        }


    </script> 
</body>
</html>